<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<link rel="stylesheet" href="/content/css/bootstrap.min.css">
	<style type="text/css">
		body {
		}

		form {
			margin-bottom: 0px;
		}

		.auth {
			display: none;
		}

		.memberPictureCard {
			border: #bbb solid 1px;
			box-shadow: 1px 1px 3px #ccc;
			font-size: 12px;
			line-height: 12px;
			padding: 5px;
			margin: 0px 5px 5px 0px;
			float: left;
			width: 100px;
			text-align: center;
			height: 120px;
			overflow: hidden;
		}

		#memberWrapper {
			display:none;
		}

		#memberContent {
			width: 500px;
		}

		#memberContent img {
			float:right;
			margin: 0px 0px 20px 20px ;
		}

		li p {
			float:left;
		}

		li img {
			float:left;
			margin: 0px 5px 5px 0px;
		}

		li {
			clear:both;
			list-style:none;
		}
	</style>
	<title>OtakyBooty's Awesome API</title>
</head>
<body>
	<div class="container">
		<div class="row">
			<div class="span12">
				<h1>OtakuBooty API<em>!!</em></h1>
			</div>
		</div>

		<!--
		<div class="row unauth" id="login">
			<div class="span12">
				<div class="well well-small">
					<form class="form-inline">
						<label for="login">
							Login
							<input type="text" id="login" name="login" placeholder="Your stupid-ass login">
						</label>
						<label for="password">
							Password
							<input id="password" type="password" name="password" placeholder="Your stupid-ass password">
						</label>
						<input type="submit" value="Authenticate!">
					</form>
					<p>
						You'll see some more shit once you authenticate.
					</p>
				</div>
			</div>
		</div>
		-->

		<div class="row auth">
			<div class="span12">
				<h2>Latest Notifications</h2>
			</div>
			<div class="span12" id="notifications">
			</div>
		</div>
		<div class="row auth">
			<div class="span12">
				<h2>Private Messages</h2>
			</div>
			<div class="span12" id="privateMessages">
			</div>
		</div>
		<div class="row auth">
			<div class="span12">
				<h2>FOPs</h2>
			</div>
			<div class="span12" id="fops">
			</div>
		</div>

		<div class="row auth">
			<div class="span12">
				<h2>Phone Numbers</h2>
			</div>
			<div class="span12" id="phoneNumberContent">
			</div>
		</div>

		<div class="row">
			<div class="span12">
				<h2>Forums You're Allowed To See</h2>
				<p id="forumsLoading">Loading...</p>
				<p>
					json API URL: <a id="forumsApiUrl" href=""></a>
				</p>
				<ul id="forumsContent">
				</ul>
			</div>
		</div>

		<div class="row" id="threads">
			<div class="span12">
				<h2>Latest Threads, <span id="forumName"></span></h2>
				<p id="threadsLoading">Loading...</p>
				<p>
					json API URL: <a id="threadsApiUrl" href=""></a>
				</p>
				<ul id="threadsContent"></ul>
			</div>
		</div>

		<div class="row hidden" id="replies">
			<div class="span12">
				<h2>Replies to <span id="threadName"></span></h2>
				<p id="repliesLoading">Loading...</p>
				<p>
					json API URL: <a id="repliesApiUrl" href=""></a>
				</p>
				<ul id="repliesContent"></ul>
			</div>
		</div>
			
		<div class="row">
			<div class="span12">
				<h2>Latest Member Pictures</h2>
				<p id="memberPicturesLoading">Loading...</p>
				<p>
					json API URL: <a id="memberPicturesApiUrl" href=""></a>
				</p>
				<p id="memberPicturesContent"></p>
			</div>
		</div>

		<div class="row" id="memberWrapper">
			<div class="span12">
				<h2 id="memberLogin"></h2>
				<p id="memberLoading">Loading...</p>
				<p>
					json API URL: <a id="memberApiUrl" href=""></a>
				</p>
				<div id="memberContent"></div>
			</div>
		</div>
	</div>

	<script id="forum" type="text/html">
		<li><a href="#" data-id-forum="{{idForum}}">{{title}}</a> <small><em>{{description}}</em></small>&nbsp;
	</script>

	<script id="thread" type="text/html">
		<li>
			{{#memberPictureUrl}}<img src="{{memberPictureUrl}}" alt="{{login}}">{{/memberPictureUrl}}
			<p>{{#sticky}}Sticky: {{/sticky}}<a href="#" data-id-thread="{{idPost}}">{{subject}}</a>
			posted by <a href="#" data-id-member="{{idMember}}">{{login}}</a> {{createdRelative}} {{#replyCount}}({{replyCount}} replies, latest by {{lastReplyLogin}}){{/replyCount}}<br>
			<small><em>{{body}}</em></small>
			</p>
		</li>
	</script>

	<script id="memberPicture" type="text/html">
		<div class="memberPictureCard" data-id-member="{{idMember}}">
			<img src="{{url}}" alt="{{caption}} {{login}}" data-id-member="{{idMember}}"><br>
			{{#caption}}<p data-id-member="{{idMember}}"><em>&ldquo;{{caption}}&rdquo;</em></p>
			{{/caption}}
			                                                                             {{login}}

		</div>
	</script>

	<script id="member" type="text/html">
		<p>
			<img src="{{primaryPhotoUrl}}" alt="{{login}}">
			Age: {{age}} Gender: {{gender}}<br>
			Location: {{friendlyLocation}}<br>
			Last visit: {{lastLoginRelative}}<br>
			Likes to fuck: {{genderPreference}}<br>
			Paid or lifetime member? {{isPaidOrLifetimeMember}}<br>
			{{#loginsPrevious}}Also known as: {{/loginsPrevious}}<br>
			{{#isMod}}Mod! {{/isMod}}
			{{#isAdmin}}Admin! {{/isAdmin}}
			{{#isSysAdmin}}SysAdmin! {{/isSysAdmin}}
		</p>
	</script>

	<script id="reply" type="text/html">
		<li>
			<im 
		</li>
	</script>


	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js">
	
	</script>
	<script>window.jQuery || document.write('<script src="content/js//jquery-1.9.0.min.js"><\/script>')</script>
	<script src="Content/js/ICanHaz.min.js"></script>
	<script type="text/javascript">
		function scrollToThing($thing) {
			$('html, body').animate({
      		scrollTop: $thing.offset().top
			}, 1000);

		}

		function loggedIn() {
			return false;
		}

		function handleTehClicks(e) {
			console.log('ooh!');
			if (e.target.attributes["data-id-forum"]) {
				e.preventDefault();
				getThreads(e.target.attributes["data-id-forum"].value);
				scrollToThing($('#threads'));
				// todo: scroll to thread replies
			}
			if (e.target.attributes["data-id-thread"]) {
				e.preventDefault();
				console.log('I should show replies for thread #' + e.target.attributes["data-id-thread"].value);
				// todo: scroll to thread replies
			}
			if (e.target.attributes["data-id-member"]) {
				e.preventDefault();
				console.log('I should show member profile information for member #' + e.target.attributes["data-id-member"].value);
				getMember(e.target.attributes["data-id-member"].value);
				// todo: scroll to member
			}
		}

		function getForums(jsonUrl) {
			$('#forumsApiUrl').attr('href', jsonUrl).html(jsonUrl);
			$('#forumsLoading').fadeIn();
			$.ajax({
				dataType: "json",
				url: jsonUrl,
				success: function (data) { showForums(data); }
			});
		}

		function showForums(jsonData) {
			$('#forumsContent').empty();
			$('#forumsLoading').fadeOut();
			for (var i = 0; i < jsonData.length; i++) {
				$('#forumsContent').append(ich.forum(jsonData[i]));
			}
			getThreads(1);
		}

		function getThreads(idForum) {
			var jsonUrl = '/api/Forums/' + idForum + '?skip=1&take=10&includeSticky=1';
			$('#threadsLoading').fadeIn();
			$('#threadsApiUrl').attr('href', jsonUrl).html(jsonUrl);
			$.ajax({
				dataType: "json",
				url: jsonUrl,
				success: function (data) { showThreads(data); }
			});
		}

		function showThreads(jsonData) {
			$('#threadsLoading').fadeOut();
			$('#threadsContent').empty();
			$('#forumName').html(jsonData.title);
			for (var i = 0; i < jsonData.threads.length; i++) {
				jsonData.threads[i].body = '"' + jsonData.threads[i].body.substring(0, 90) + '..."';
				$('#threadsContent').append(ich.thread(jsonData.threads[i]));
			}
		}

		function getMemberPictures(jsonUrl) {
			$('#memberPicturesLoading').fadeIn();
			$('#memberPicturesApiUrl').attr('href', jsonUrl).html(jsonUrl);
			$.ajax({
				dataType: "json",
				url: jsonUrl,
				success: function (data) { showMemberPictures(data); }
			});
		}

		function showMemberPictures(jsonData) {
			$('#memberPicturesLoading').fadeOut();
			$('#memberPicturesContent').empty();
			for (var i = 0; i < jsonData.length; i++) {
				$('#memberPicturesContent').append(ich.memberPicture(jsonData[i]));
			}
		}

		function getMember(idMember) {
			var jsonUrl = '/api/Members/' + idMember;
			$('#memberApiUrl').html(jsonUrl);
			$('#memberLoading').fadeIn();
			$('#memberWrapper').show(); //fadeIn();
			$.ajax({
				dataType: "json",
				url: jsonUrl,
				success: function (data) { showMember(data); }
			});
		}

		function showMember(jsonData) {
			scrollToThing($('#memberWrapper'));
			$('#memberLoading').fadeOut();
			$('#memberContent').empty();
			$('#memberLogin').html(jsonData.member.login);
			$('#memberContent').append(ich.member(jsonData.member));
		}

		$(function () {


			console.log('Hello. Your DOM is ready, sir.');

			if (loggedIn()) {
				// call a bunch of auth-only APIs
			}
			else {
				getForums('api/Forums/');
				getMemberPictures('api/MemberPictures?skip=0&take=20');
			}

			$(document).click(function (e) {
				handleTehClicks(e);
			});


		});
	</script>
</body>
</html>
